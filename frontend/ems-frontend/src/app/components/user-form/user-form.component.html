<h2 mat-dialog-title>
  <mat-icon>{{ isEditMode ? 'edit' : 'person_add' }}</mat-icon>
  {{ getFormTitle() }}
</h2>

<mat-dialog-content>
  <form [formGroup]="userForm">
    <div class="form-row">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Nom d'utilisateur</mat-label>
        <input matInput formControlName="username" required>
        <mat-icon matPrefix>account_circle</mat-icon>
        <mat-error *ngIf="userForm.get('username')?.hasError('required')">
          Le nom d'utilisateur est requis
        </mat-error>
        <mat-error *ngIf="userForm.get('username')?.hasError('minlength')">
          Minimum 3 caractères
        </mat-error>
        <mat-error *ngIf="userForm.get('username')?.hasError('maxlength')">
          Maximum 50 caractères
        </mat-error>
      </mat-form-field>
    </div>

    <div class="form-row">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Email</mat-label>
        <input matInput type="email" formControlName="email" required>
        <mat-icon matPrefix>email</mat-icon>
        <mat-error *ngIf="userForm.get('email')?.hasError('required')">
          L'email est requis
        </mat-error>
        <mat-error *ngIf="userForm.get('email')?.hasError('email')">
          Email invalide
        </mat-error>
      </mat-form-field>
    </div>

    <div class="form-row">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>{{ isEditMode ? 'Nouveau mot de passe (optionnel)' : 'Mot de passe' }}</mat-label>
        <input matInput type="password" formControlName="password" [required]="!isEditMode">
        <mat-icon matPrefix>lock</mat-icon>
        <mat-error *ngIf="userForm.get('password')?.hasError('required')">
          Le mot de passe est requis
        </mat-error>
        <mat-error *ngIf="userForm.get('password')?.hasError('minlength')">
          Minimum 6 caractères
        </mat-error>
      </mat-form-field>
    </div>

    <div class="form-row two-columns">
      <mat-form-field appearance="outline">
        <mat-label>Prénom</mat-label>
        <input matInput formControlName="firstName">
        <mat-icon matPrefix>person</mat-icon>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Nom</mat-label>
        <input matInput formControlName="lastName">
        <mat-icon matPrefix>person</mat-icon>
      </mat-form-field>
    </div>

    <div class="roles-section" formGroupName="roles">
      <h3>Rôles</h3>
      <div class="roles-checkboxes">
        <mat-checkbox
          *ngFor="let role of availableRoles"
          [formControlName]="role.name"
          [color]="'primary'"
        >
          {{ role.label }}
        </mat-checkbox>
      </div>
    </div>
  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="onCancel()">
    Annuler
  </button>
  <button
    mat-raised-button
    color="primary"
    (click)="onSubmit()"
    [disabled]="!userForm.valid"
  >
    <mat-icon>{{ isEditMode ? 'save' : 'add' }}</mat-icon>
    {{ getSubmitButtonText() }}
  </button>
</mat-dialog-actions>
